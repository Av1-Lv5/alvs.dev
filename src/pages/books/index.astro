---
import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import BookPagination from "@components/BookPagination.astro";
import BookCard from "@components/BookCard.astro";

const allBooks = await getCollection("books");
const booksPerPage = 12;
const totalPages = Math.ceil(allBooks.length / booksPerPage);
const currentPage = 1;
const startIndex = (currentPage - 1) * booksPerPage;
const endIndex = startIndex + booksPerPage;
const booksToShow = allBooks.slice(startIndex, endIndex);
---

<PageLayout tabTitle="Books" description="Reading that stuck.">
  <section class="hero">
    <h1>Books I've read</h1>
    <p class="hero-text">
      Books I've read. If something here overlaps with your shelf, let's talk.
    </p>
  </section>

  <div class="books-grid">
    {booksToShow.map((book) => <BookCard book={book} />)}
  </div>

  <BookPagination
    currentPage={currentPage}
    totalPages={totalPages}
    hasNext={currentPage < totalPages}
    hasPrev={currentPage > 1}
    nextUrl={`/books/${currentPage + 1}`}
    prevUrl="/books"
  />

  <blockquote>
    If you have recommendations based on what you see here, feel free to
    <a href="mailto:alvs.codee@slmail.me">email me</a>
  </blockquote>
</PageLayout>

<style>
  .books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 1.25rem;
  }

  @media (max-width: 640px) {
    .books-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }
  }
</style>
